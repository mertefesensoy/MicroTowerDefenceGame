# Project Setup Guide

## Quick Start (New Developer / Fresh Clone)

### 1. Install XcodeGen
```bash
./scripts/install_xcodegen.sh
```

This script will:
- Check if XcodeGen is already installed
- Try Homebrew first (`brew install xcodegen`)
- Fall back to manual binary download if Homebrew unavailable
- Install to `./bin/xcodegen-final` (gitignored)

### 2. Generate Xcode Project
```bash
./scripts/generate_project.sh
```

This generates `MicroTowerDefenceGame.xcodeproj` from `project.yml`.

**Note**: The `.xcodeproj` is gitignored and must be regenerated on each machine.

### 3. Open in Xcode
```bash
open MicroTowerDefenceGame.xcodeproj
```

### 4. Build and Run
- Select scheme: **MicroTowerDefenceGame**
- Select simulator: iPhone 15 (or any iOS 16+ device)
- Press ⌘R to build and run

---

## Why is `.xcodeproj` Gitignored?

**Reason**: Using XcodeGen for project generation avoids merge conflicts in `.xcodeproj` files.

**Source of truth**: `project.yml` (version controlled)  
**Generated**: `.xcodeproj` (local, not committed)

Every developer regenerates the project locally using XcodeGen.

---

## Why is `bin/` Gitignored?

**Reason**: Don't commit third-party binaries to git. Download/install them via documented setup instead.

**For XcodeGen**:
- **CI**: Uses Homebrew (`brew install xcodegen`)
- **Local dev**: Either Homebrew or `./scripts/install_xcodegen.sh`

---

## Dependency Management

### Ruby (Fastlane)
```bash
bundle install --path vendor/bundle
```

**Locked**: `Gemfile.lock` (committed)

### Swift Package Manager
**MicroTDCore**: Local package with zero external dependencies  
**No Package.resolved needed**: Deterministic by default

**If external SwiftPM dependencies are added later**:
- `Package.resolved` will be generated
- Commit it for CI determinism

---

## CI / GitHub Actions

All workflows automatically:
1. Install XcodeGen via Homebrew
2. Generate project via `xcodegen generate`
3. Resolve SwiftPM dependencies
4. Build/test/deploy

See:
- [.github/workflows/app-ci.yml](file:///.github/workflows/app-ci.yml) - PR builds
- [.github/workflows/core-ci.yml](file:///.github/workflows/core-ci.yml) - Core package tests
- [.github/workflows/ios-beta.yml](file:///.github/workflows/ios-beta.yml) - TestFlight deployment

---

## First-Time Release Setup

See [phase1_execution_checklist.md](../../../.gemini/antigravity/brain/6281697d-db61-4ebb-8fe5-17f227861da7/phase1_execution_checklist.md) for:
- Creating match repository
- Configuring `.env.match`
- Running `fastlane bootstrap_signing`
- Deploying to TestFlight

---

## Troubleshooting

### "XcodeGen not found"
```bash
./scripts/install_xcodegen.sh
```

### "Project not found"
```bash
./scripts/generate_project.sh
```

### "Bundle install fails"
```bash
bundle install --path vendor/bundle
```

### "Gatekeeper blocks xcodegen"
```bash
xattr -dr com.apple.quarantine ./bin/xcodegen-final
```

---

## Project Structure

```
MicroTowerDefenceGame/
├── project.yml                 # XcodeGen spec (source of truth)
├── MicroTDCore/                # Swift package (core game logic)
├── MicroTowerDefenceGame/      # iOS app target
├── scripts/
│   ├── install_xcodegen.sh    # XcodeGen installation helper
│   └── generate_project.sh    # Project generation helper
├── fastlane/                   # Release automation
├── .github/workflows/          # CI/CD
└── docs/                       # Documentation

# Gitignored (generated/local)
├── MicroTowerDefenceGame.xcodeproj/  # Generated by XcodeGen
├── bin/xcodegen-final               # Downloaded binary
└── vendor/                          # Ruby gems (local install)
```

---

## Quick Commands Reference

```bash
# Setup
./scripts/install_xcodegen.sh
./scripts/generate_project.sh

# Build
xcodebuild -project MicroTowerDefenceGame.xcodeproj \
  -scheme MicroTowerDefenceGame \
  -destination 'platform=iOS Simulator,name=iPhone 15' \
  build

# Run tests
cd MicroTDCore && swift test

# Generate project (if project.yml changes)
./scripts/generate_project.sh

# TestFlight deployment (after credentials setup)
bundle exec fastlane beta
```
